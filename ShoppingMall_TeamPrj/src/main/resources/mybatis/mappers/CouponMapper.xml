<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
   "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.shop.ShoppingMall_TeamPrj.coupons.mapper.CouponMapper">

    <!-- 특정 쿠폰 조회 -->
    <select id="getCouponById" parameterType="int" resultType="com.shop.ShoppingMall_TeamPrj.coupons.vo.CouponVO">
        SELECT * FROM coupons WHERE coupon_id = #{couponId}
    </select>

    <!-- 모든 쿠폰 목록 조회 -->
    <select id="getAllCoupons" resultType="com.shop.ShoppingMall_TeamPrj.coupons.vo.CouponVO">
        SELECT * FROM coupons
    </select>

    <!-- 새로운 쿠폰 삽입 -->
    <insert id="insertCoupon" parameterType="com.shop.ShoppingMall_TeamPrj.coupons.vo.CouponVO">
        INSERT INTO coupons (coupon_code, description, discount_type, discount_value, min_purchase, valid_from, valid_to, usage_limit, used_count, status)
        VALUES (#{couponCode}, #{description}, #{discountType}, #{discountValue}, #{minPurchase}, #{validFrom}, #{validTo}, #{usageLimit}, #{usedCount}, #{status})
    </insert>

    <!-- 기존 쿠폰 업데이트 -->
    <update id="updateCoupon" parameterType="com.shop.ShoppingMall_TeamPrj.coupons.vo.CouponVO">
        UPDATE coupons
        SET coupon_code = #{couponCode},
            description = #{description},
            discount_type = #{discountType},
            discount_value = #{discountValue},
            min_purchase = #{minPurchase},
            valid_from = #{validFrom},
            valid_to = #{validTo},
            usage_limit = #{usageLimit},
            used_count = #{usedCount},
            status = #{status}
        WHERE coupon_id = #{couponId}
    </update>

    <!-- 쿠폰 삭제 -->
    <delete id="deleteCoupon" parameterType="int">
        DELETE FROM coupons WHERE coupon_id = #{couponId}
    </delete>

    <!-- 사용자 쿠폰 조회 -->
    <select id="getUserCouponsByUserId" parameterType="int" resultType="com.shop.ShoppingMall_TeamPrj.coupons.vo.UserCouponVO">
        SELECT * FROM user_coupons WHERE user_id = #{userId}
    </select>

    <!-- 사용자 쿠폰 삽입 -->
    <insert id="insertUserCoupon" parameterType="com.shop.ShoppingMall_TeamPrj.coupons.vo.UserCouponVO">
        INSERT INTO user_coupons (user_id, coupon_id, status, used_at)
        VALUES (#{userId}, #{couponId}, #{status}, #{usedAt})
    </insert>

</mapper>
